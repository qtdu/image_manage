<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>CRUD Google Sheet</title>
<style>
body{font-family:sans-serif;max-width:600px;margin:auto}
input,textarea,button{width:100%;margin:5px 0}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:5px;text-align:left}
button{cursor:pointer}
</style>
</head>
<body>

<h2>CRUD Google Sheet</h2>

<input id="name" placeholder="Tên">
<textarea id="note" placeholder="Chú thích"></textarea>
<button onclick="add()">Thêm</button>

<hr>

<table>
<thead>
<tr><th>Name</th><th>Note</th><th>Action</th></tr>
</thead>
<tbody id="list"></tbody>
</table>

<script>
const API = "https://script.google.com/macros/s/AKfycbyvlUGgSsi4L8tnjdGG4EzgCBtlqBp_vfR6ckDzn6bJ1nARIf55F4DXfRz5_QV74zM/exec";

function load(){
  fetch(API)
    .then(r=>r.json())
    .then(data=>{
      const tb=document.getElementById("list");
      tb.innerHTML="";
      data.forEach(i=>{
        tb.innerHTML+=`
          <tr>
            <td>${i.name}</td>
            <td>${i.note}</td>
            <td>
              <button onclick="edit('${i.id}','${i.name}','${i.note}')">Edit</button>
              <button onclick="del('${i.id}')">X</button>
            </td>
          </tr>`;
      });
    });
}

function post(data){
  return fetch(API,{
    method:"POST",
    body:JSON.stringify(data)
  });
}

function add(){
  post({
    action:"add",
    name:name.value,
    note:note.value
  }).then(load);
}

function edit(id,noteName,noteText){
  name.value = noteName;
  note.value = noteText;
  if(confirm("Lưu chỉnh sửa?")){
    post({
      action:"edit",
      id:id,
      name:name.value,
      note:note.value
    }).then(load);
  }
}

function del(id){
  if(confirm("Xóa dòng này?")){
    post({action:"delete",id:id}).then(load);
  }
}

load();
</script>

</body>
</html>
