<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Google Sheet CRUD Inline</title>
<style>
body{font-family:sans-serif;max-width:900px;margin:auto}
input,button{margin:4px;padding:4px}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:6px}
td[contenteditable]{background:#f9f9f9}
td:focus{outline:2px solid #4caf50}
</style>
</head>
<body>

<h3>Thêm dữ liệu</h3>

<input id="link" placeholder="Link">
<input id="name1" placeholder="Name">
<input id="note" placeholder="Note">
<button onclick="add()">Thêm</button>

<hr>

<table>
<thead>
<tr>
  <th>Time</th>
  <th>Link</th>
  <th>Name</th>
  <th>Note</th>
  <th>X</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<script>
const API = "https://script.google.com/macros/s/AKfycbymlIeO7SqDLqE_3HHGbhYyPlKiT1mlBSR58njBzUWHUGAbOQYdMnSvX7CeL0OkX48/exec";

function load(){
  fetch(API).then(r=>r.json()).then(data=>{
    const tb = document.getElementById("list");
    tb.innerHTML = "";
    data.reverse().forEach(d=>{
      tb.innerHTML += `
      <tr>
        <td>${d.time}</td>
        <td contenteditable onkeydown="save(event,${d.row},2,this)">${d.link}</td>
        <td contenteditable onkeydown="save(event,${d.row},3,this)">${d.name}</td>
        <td contenteditable onkeydown="save(event,${d.row},4,this)">${d.note}</td>
        <td><button onclick="del(${d.row})">X</button></td>
      </tr>`;
    });
  });
}

function post(data){
  return fetch(API,{
    method:"POST",
    body:JSON.stringify(data)
  });
}

function add(){
  post({
    action:"add",
    link:link.value,
    name:name1.value,
    note:note.value
  }).then(()=>{
    link.value = "";
    name1.value = "";
    note.value = "";
    load();
  });
}

function save(e,row,col,el){
  if(e.key==="Enter"){
    e.preventDefault();
    post({
      action:"update",
      row:row,
      col:col,
      value:el.textContent
    });
    el.blur();
  }
}

function del(row){
  if(confirm("Xóa dòng này?")){
    post({action:"delete",row:row}).then(load);
  }
}

load();
</script>

</body>
</html>
