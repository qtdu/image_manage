<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ImgBB + Google Sheet Gallery</title>
<style>
body{font-family:sans-serif;max-width:800px;margin:auto;padding:20px}
input,textarea,button{width:100%;margin:6px 0;padding:6px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px}
.card{text-align:center;border:1px solid #ccc;padding:6px;border-radius:6px}
.card img{max-width:100%;cursor:pointer}
.name{color:blue;cursor:pointer;text-decoration:underline}
#popup{position:fixed;top:0;left:0;width:100%;height:100%;background:#0008;display:none}
#popup .box{background:#fff;padding:20px;margin:10% auto;max-width:400px}
</style>
</head>

<body>

<h2>Upload ảnh</h2>

<input type="text" id="name" placeholder="Tên">
<textarea id="note" placeholder="Chú thích"></textarea>
<input type="file" id="imageInput" accept="image/*">
<button onclick="uploadImage()">Upload</button>

<hr>
<h2>Gallery</h2>
<div id="gallery" class="grid"></div>

<div id="popup" onclick="this.style.display='none'">
  <div class="box" onclick="event.stopPropagation()">
    <h3 id="pname"></h3>
    <p id="pnote"></p>
  </div>
</div>

<script>
const IMGBB_KEY = "98bce19081883f35f02cec232ce565b5";
const SHEET_API = "https://script.google.com/macros/s/AKfycbzKf8sIcOdt3fkU_31VP8Ik1E5s9VkvmUZKb7l-6JzfunfxDqotuXbM1FKKCqS2RNo/exec";

// ================= LOAD GALLERY =================
function loadGallery(){
  fetch(SHEET_API)
    .then(r=>r.json())
    .then(data=>{
      const g=document.getElementById("gallery");
      g.innerHTML="";
      data.reverse().forEach(i=>{
        const div=document.createElement("div");
        div.className="card";
        div.innerHTML=`
          <img src="${i.image}">
          <div class="name" onclick="showNote('${i.name}','${i.note}')">${i.name}</div>
        `;
        g.appendChild(div);
      });
    });
}

// ================= POPUP =================
function showNote(name,note){
  document.getElementById("pname").textContent=name;
  document.getElementById("pnote").textContent=note;
  document.getElementById("popup").style.display="block";
}

// ================= UPLOAD =================
function uploadImage(){
  const file=document.getElementById("imageInput").files[0];
  const name=document.getElementById("name").value;
  const note=document.getElementById("note").value;
  if(!file||!name) return alert("Thiếu dữ liệu");

  const reader=new FileReader();
  reader.onload=()=>{
    const b64=reader.result.split(",")[1];
    const fd=new FormData();
    fd.append("key",IMGBB_KEY);
    fd.append("image",b64);

    fetch("https://api.imgbb.com/1/upload",{method:"POST",body:fd})
      .then(r=>r.json())
      .then(res=>{
        const image=res.data.url;
        fetch(SHEET_API,{
          method:"POST",
          body:JSON.stringify({image,name,note})
        }).then(()=>{
          document.getElementById("imageInput").value="";
          loadGallery();
        });
      });
  };
  reader.readAsDataURL(file);
}

loadGallery();
</script>

</body>
</html>
