<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Upload ảnh ImgBB + Sheet</title>

<style>
body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
img { max-width: 100%; border: 1px solid #ccc; }
input, textarea { width: 100%; margin-bottom: 10px; }
.card { border: 1px solid #ddd; padding: 10px; margin-top: 15px; }
.name { color: blue; cursor: pointer; font-weight: bold; margin-top: 5px; }
.note { display: none; margin-top: 5px; color: #555; }
</style>
</head>

<body>

<h2>Upload ảnh lên ImgBB</h2>

<input type="file" id="imageInput" accept="image/*">
<input type="text" id="nameInput" placeholder="Tên ảnh (bỏ trống = tên mặc định)">
<textarea id="noteInput" placeholder="Chú thích"></textarea>

<button onclick="uploadImage()">Tải lên</button>
<div id="status"></div>

<hr>
<h2>Danh sách ảnh</h2>
<div id="gallery"></div>

<script>
const IMGBB_API_KEY = "98bce19081883f35f02cec232ce565b5";
const SHEET_API = "https://script.google.com/macros/s/AKfycbxqdQ-kYTCzRNFBKWa4GzWiyg6aLsPonz_ObsN8En11H_eNxEXTF7K6jaS4QEXWNA/exec";

function uploadImage() {
  const file = imageInput.files[0];
  if (!file) return alert("Chọn ảnh");

  status.textContent = "Đang tải lên...";

  const reader = new FileReader();
  reader.onload = () => {
    const base64 = reader.result.split(",")[1];
    const form = new FormData();
    form.append("key", IMGBB_API_KEY);
    form.append("image", base64);

    fetch("https://api.imgbb.com/1/upload", {
      method: "POST",
      body: form
    })
    .then(r => r.json())
    .then(d => {
      if (!d.success) throw d;

      const link = d.data.url;
      const name = nameInput.value || d.data.image.filename;
      const note = noteInput.value;

      return fetch(SHEET_API, {
        method: "POST",
        body: JSON.stringify({ link, name, note })
      });
    })
    .then(() => {
      status.textContent = "Upload thành công!";
      imageInput.value = "";
      nameInput.value = "";
      noteInput.value = "";
      loadGallery();
    })
    .catch(err => {
      console.error(err);
      status.textContent = "Lỗi upload";
    });
  };
  reader.readAsDataURL(file);
}

function loadGallery() {
  fetch(SHEET_API)
    .then(r => r.json())
    .then(data => {
      gallery.innerHTML = "";
      data.reverse().forEach(item => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <img src="${item.link}">
          <div class="name">${item.name}</div>
          <div class="note">${item.note || "(không có chú thích)"}</div>
        `;
        div.querySelector(".name").onclick = () => {
          const n = div.querySelector(".note");
          n.style.display = n.style.display === "none" ? "block" : "none";
        };
        gallery.appendChild(div);
      });
    });
}

loadGallery();
</script>

</body>
</html>
